<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>FontMaker V1</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/opentype.js/1.3.4/opentype.min.js"></script>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: #0b0d17;
      color: #eee;
      display: flex;
      height: 100vh;
      overflow: hidden;
    }
    #sidebar {
      width: 250px;
      background: #111522;
      border-right: 2px solid #1f2537;
      display: flex;
      flex-direction: column;
    }
    #tabs {
      flex: 1;
      overflow-y: auto;
      padding: 10px;
    }
    #tabs button {
      width: 100%;
      margin: 5px 0;
      padding: 10px;
      background: #1a2236;
      border: none;
      color: #eee;
      cursor: pointer;
      border-radius: 8px;
    }
    #tabs button:hover {
      background: #25304a;
    }
    #main {
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    #toolbar {
      background: #111522;
      padding: 8px;
      display: flex;
      align-items: center;
      gap: 10px;
      border-bottom: 2px solid #1f2537;
    }
    #glyph-grid {
      flex: 1;
      display: grid;
      grid-template-columns: repeat(auto-fill, 80px);
      grid-auto-rows: 80px;
      gap: 8px;
      padding: 10px;
      overflow-y: auto;
    }
    .glyph-box {
      background: #1a2236;
      border: 2px solid #2a3452;
      border-radius: 8px;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      font-size: 20px;
      color: #66aaff;
    }
    .glyph-box:hover {
      background: #25304a;
    }
    #editor-modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.85);
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    #editor {
      background: #111522;
      padding: 20px;
      border-radius: 12px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    #canvas {
      background: #fff;
      border: 2px solid #444;
      cursor: crosshair;
    }
    #tools button {
      margin: 2px;
      padding: 5px 10px;
      background: #1a2236;
      border: none;
      color: #eee;
      border-radius: 6px;
      cursor: pointer;
    }
    #tools button:hover {
      background: #25304a;
    }
  </style>
</head>
<body>
  <div id="sidebar">
    <div id="tabs">
      <button id="newFontBtn">+ New Font</button>
    </div>
  </div>
  <div id="main">
    <div id="toolbar">
      <button id="exportBtn">Export TTF</button>
      <button id="importBtn">Import TTF</button>
    </div>
    <div id="glyph-grid"></div>
  </div>

  <div id="editor-modal">
    <div id="editor">
      <canvas id="canvas" width="400" height="400"></canvas>
      <div id="tools">
        <button data-tool="pencil">Pencil</button>
        <button data-tool="line">Line</button>
        <button data-tool="curve">Curve</button>
        <button data-tool="jagged">Jagged</button>
        <button data-tool="spray">Spray</button>
        <button data-tool="eraser">Eraser</button>
      </div>
      <button id="saveGlyphBtn">Save Glyph</button>
      <button id="closeEditorBtn">Close</button>
    </div>
  </div>

  <script>
    let fonts = [];
    let currentFont = null;
    let currentGlyphIndex = null;
    const glyphGrid = document.getElementById('glyph-grid');
    const editorModal = document.getElementById('editor-modal');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    let drawing = false;
    let tool = 'pencil';

    document.querySelectorAll('#tools button').forEach(btn => {
      btn.addEventListener('click', () => tool = btn.dataset.tool);
    });

    document.getElementById('newFontBtn').onclick = () => {
      const name = prompt('Font name:');
      if (!name) return;
      const font = { name, glyphs: [], assignments: [] };
      for (let i = 0; i < 113; i++) {
        font.glyphs.push(null);
        font.assignments.push(assignCharacter(i));
      }
      fonts.push(font);
      currentFont = font;
      renderGlyphGrid();
    };

    function assignCharacter(i) {
      const seq = 'AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz0123456789';
      return seq[i % seq.length] || String.fromCharCode(33 + (i % 94));
    }

    function renderGlyphGrid() {
      glyphGrid.innerHTML = '';
      currentFont.glyphs.forEach((g, i) => {
        const div = document.createElement('div');
        div.className = 'glyph-box';
        div.textContent = currentFont.assignments[i];
        div.ondblclick = () => openEditor(i);
        glyphGrid.appendChild(div);
      });
    }

    function openEditor(i) {
      currentGlyphIndex = i;
      ctx.clearRect(0,0,canvas.width,canvas.height);
      editorModal.style.display = 'flex';
    }

    document.getElementById('closeEditorBtn').onclick = () => editorModal.style.display = 'none';

    document.getElementById('saveGlyphBtn').onclick = () => {
      const img = canvas.toDataURL();
      currentFont.glyphs[currentGlyphIndex] = img;
      editorModal.style.display = 'none';
    };

    canvas.addEventListener('mousedown', e => {
      drawing = true;
      ctx.beginPath();
      ctx.moveTo(e.offsetX, e.offsetY);
    });
    canvas.addEventListener('mousemove', e => {
      if (!drawing) return;
      if (tool === 'pencil') {
        ctx.lineTo(e.offsetX, e.offsetY);
        ctx.stroke();
      } else if (tool === 'line') {
        ctx.clearRect(0,0,canvas.width,canvas.height);
        ctx.beginPath();
        ctx.moveTo(startX, startY);
        ctx.lineTo(e.offsetX, e.offsetY);
        ctx.stroke();
      }
    });
    canvas.addEventListener('mouseup', e => {
      drawing = false;
    });

    document.getElementById('exportBtn').onclick = () => {
      const glyphs = [];
      currentFont.glyphs.forEach((img, i) => {
        if (!img) return;
        const path = new opentype.Path();
        path.moveTo(0,0);
        path.lineTo(200,0);
        path.lineTo(200,200);
        path.lineTo(0,200);
        path.close();
        glyphs.push(new opentype.Glyph({
          name: currentFont.assignments[i],
          unicode: currentFont.assignments[i].charCodeAt(0),
          advanceWidth: 200,
          path
        }));
      });
      const font = new opentype.Font({
        familyName: currentFont.name,
        styleName: 'Regular',
        unitsPerEm: 1000,
        ascender: 800,
        descender: -200,
        glyphs
      });
      const arrayBuffer = font.toArrayBuffer();
      const blob = new Blob([arrayBuffer], { type: 'font/ttf' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = currentFont.name + '.ttf';
      a.click();
    };
  </script>
</body>
</html>
